= Обновление БД

Версия базы данных {dv} должна соответствовать версии сервера {dv}.

[NOTE]
====
При обновлении БД {dv} индексы, добавленные самостоятельно, будут удалены.
====

.Чтобы обновить БД до версии сервера, выполните следующие действия.
. Откройте страницу настроек сервера приложений menu:Серверы[Имя-сервера > Сервер приложений > Базы данных] xref:db-master.adoc[мастер БД {dv}].
+
.Мастер БД {dv}
image::dev@platform:admin:database-master.png[Мастер БД {dv}]
+
. Найдите в списке обновляемую базу данных и нажмите кнопку *Обновить* в правой части строки.
. Выберите библиотеки карточек, которые должны быть обновлены. Нажмите *Далее*.
+
.Выбор обновляемых библиотек карточек
image::dev@platform:admin:db-update-libs.png[Выбор обновляемых библиотек карточек]
+
****
.. Библиотеки карточек, версии которых отличаются от установленных в БД, будут автоматически выбраны -- данные библиотеки могут быть обновлены.
+
Если версия загружаемой библиотеки карточек не отличается от версии в БД или файлы библиотеки карточек отсутствуют в каталоге сервера {dv} `C:\Program Files (x86)\Docsvision\Platform\Tools\Database`, выбор таких библиотек карточек будет заблокирован. Строчки с такими библиотеками карточек будут серого цвета, а флаг -- неактивен.
+
.. В строке _Пользовательские метаданные_ указано была ли модифицирована установленная в БД библиотека карточек (добавлены пользовательские метаданные).
+
.. В строке с режимом обновления БД указывается выбранный платформой {dv} вариант обновления БД:
+
* _Полный режим_ -- выбранные библиотеки карточек и версии клиентских компонентов будут обновлены полностью.
* _Лёгкий режим_ -- будет обновлена только информация о версии клиентских компонентов.
+
Если для обновления выбрано несколько библиотек карточек и одна из них требует полного обновления, то в строке с режимом обновления будет указано `База данных будет обновлена в полном режиме`. При этом каждая библиотека обновляется в требуемом ей режиме.
+
.Принцип определения требуемого режима обновления:
[NOTE]
====
* Если изменилась версия генератора схем карточек, все библиотеки карточек будут обновлены в полном режиме.
* Если изменилась схема библиотеки карточек, но не изменилась схема её карточек, будут установлены или обновлены только расширенные отчёты и скрипты данной библиотеки карточек.
* Если изменилась схема одной или нескольких карточек библиотеки карточек, библиотека карточек будет обновлена полностью.
* Если изменений генератора, схемы библиотеки карточек и схем карточек не было, обновление будет выполнено в лёгком режиме.
====
****
+
. Подтвердите настройки, которые будут использованы для обновления базы данных. Нажмите *Далее*.
+
.Мастер БД {dv} в режиме обновления базы данных
image::dev@platform:admin:db-update-check.png[Мастер БД {dv} в режиме обновления базы данных]
+
include::partial$excerpts.adoc[tags=atomic]
+
. Утвердительно ответьте на запрос об обновлении БД. Дождитесь завершения обновления БД и загрузки SQL объектов.
+
[WARNING]
====
Обновление базы данных может занять продолжительное время. Пользователи и сервисы, использующие эту базу данных, будут отключены, и не смогут подключаться к ней до окончания процесса обновления.
====
+
Если процесс обновления базы данных был прерван по таймауту, увеличьте значение настройки `Ожидать завершения атомарной операции на SQL Server (сек)` и повторите процедуру обновления.
+
. Выберите модули {dv}, настройки которых должны быть обновлены в БД, и нажмите кнопку *Завершить*. При этом существующие в БД стандартные настройки выбранных модулей будут перезаписаны.
+
.Выбор модулей, настройки которых будут загружены в БД
image::dev@platform:admin:db-create-modules.png[Выбор модулей, настройки которых будут загружены в БД]
+
Возможность выбора модулей, настройки которых не нуждаются в обновлении (версия в БД является актуальной), будет заблокирована.
+
. Дождитесь завершения загрузки настроек.
// . Перезапустите сервисы {dv}, чтобы применить новые параметры.
// +
// .Запрос на перезапуск сервисов {dv}
// image::admin:db-create-reload.png[Запрос на перезапуск сервисов {dv}]
// +
// . На сервере Linux, в конфигурационном файле модулей укажите имя создаваемой БД xref:admin:config-platform.adoc[конфигурационном файле] модуля {pl} и перезапустите службу *{sss-new}* командами:
// +
// [source,bash]
// ----
// sudo systemctl stop dvappserver
// sudo systemctl start dvappserver
// ----
//tag::special[]
// . Примените специальную конфигурацию _{dm}_.
// +
// .Специальная конфигурация {dm}
// image::platform:admin:document-management.png[Специальная конфигурация {dm}]
// +
// Применение специальной конфигурации может быть пропущено, чтобы сохранить существующие настройки модуля {dm}.
// +
// . Примените специальную конфигурацию _{ad}_.
// +
// .Специальная конфигурация {ad}
// image::platform:admin:approval-designer.png[Специальная конфигурация {ad}]
// +
// Применение специальной конфигурации может быть пропущено, чтобы сохранить существующие настройки модуля {ad}.
//end::special[]
+
. Перед обновлением поиск автоматически отключается. Приведите базу данных к рабочему состоянию, включив систему полнотекстового поиска.
. Повторно создайте все индексы, которые были добавлены при внедрении системы.
. Если в базу данных при внедрении системы были добавлены триггеры, после обновления базы данных их потребуется создать повторно.

