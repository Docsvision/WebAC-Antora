= Настройка Службы {ws}

Служба {ws} -- дополнительный сервис {dv} для фоновой обработки задач, формируемых компонентами системы {dv}.

Чтобы получить подробную информацию об устройстве Службы {ws}, обратитесь к документации модуля {dv} Служба {ws}, раздел "xref:5.5.2@workerservice::index.adoc[]".

{mc} позволяет управлять фоновыми операциями Службы {ws}: регистрировать новые фоновые операции и выбирать их конфигурацию для обработки задач.

При настройке Службы {ws} следует отличать _узлы_ от _{ws}_. _Узлы_ -- это установленные экземпляры модуля Служба {ws}. Пользователю Модуля не нужно самостоятельно подключать узлы Службы {ws} к {of-mc}. Узлы Службы {ws} автоматически регистрируются в {of-mc}, указанной при их установке.

_Фоновые операции_ -- запущенные на _узле_ экземпляры сервиса, непосредственно обрабатывающего фоновые задачи. Каждый экземпляр _{of-ws}_ ассоциируется с _конфигурацией_, которая определяет перечень обрабатываемых задач и используемых при этом компонентов.

[#tab]
== Вкладка "Служба {ws}"

На вкладке настраивается обработка конкретных экземпляров конфигурации (процессов) на узле {ws}. На данной вкладке администратор решает, будет ли процесс Службы {ws} работать с расширениями модулей или нет.

.Вкладка "Служба {ws}"
image::worker-tab.png[Вкладка "Служба {ws}"]

В верхней части вкладки указывается адрес подключения к _{to-sett-serv}_.

Под заголовком вкладки отображаются узлы Службы {ws}. На рисунке изображён единственный узел под названием _Administrator Workplace_.
Набор узлов определяется по зарегистрированным узлам в _{sett-serv}_. Узлы добавляются автоматически при установке Службы {ws}.

Слева от названия каждого узла отображается индикатор текущего состояния узла. Узел может быть доступен -- индикатор зелёный или недоступен -- индикатор красный. Состояние узла обновляется при обновлении страницы или при нажатии на кнопку статуса.

.Обновить состояние узла
image::refresh-node.png[Обновить состояние узла]

[#refresh]
****
Нажатие на индикатор обновляет статус узла (доступен или недоступен).

Перезапустить *отдельный узел* можно при помощи кнопки image:buttons/reload.png[Обновить] справа напротив заголовка ро. Кнопка image:buttons/reload.png[Обновить против часовой] перезапускает отдельный процесс Службы {ws}.

Перезапустить *все узлы* можно при помощи кнопки image:buttons/refresh.png[Обновить по часовой] справа напротив заголовка узла. Кнопка image:buttons/refresh.png[Обновить по часовой] перезапускает все процессы Службы {ws}.
****

После установки модулей {dv} (например, модуля _{bo}_) в _{sett-serv}_ Консоли автоматически появляются процессы Службы {ws}. Каждый узел может обрабатывать процессы с определённым типом конфигурации. Такие процессы отображаются в списке. Тип конфигурации можно выбрать только из тех расширений, с которыми работает данный узел Службы {ws}.

//Под именем узла располагается строка _Файл логов_. В строке указывается имя файла журнала работы _Службы {ws}_. При нажатии на имя файла, будет открыта xref:logs.adoc[страница "Логи"]. Уровень логов настраивается на той же странице.

[#add]
== Добавить процесс

.Заполнение данных о процессе
image::add-worker.png[Заполнение данных о процессе]

.Чтобы подключить новый процесс:
. Откройте страницу настроек нажатием на кнопку image:buttons/settings.png[Молоток и ключ].
. Перейдите на вкладку "Служба {ws}".
. Нажмите на кнопку *Подключить процесс*
. В появившемся окне введите _Имя процесса_ и выберите _Тип конфигурации_.
+
****
Имя процесса::
Произвольное имя процесса для его идентификации.

Тип конфигурации::
Тип конфигурации определяет список задач, выполняемых процессом, и метод их выполнения.
+
* Базовые объекты / Back office -- конфигурация для обработки заданий и групп заданий.
* Обслуживание ЭП / Signature maintenance (сервис перештамповки) -- конфигурация для обработки электронных подписей: вычисление типа, статуса и времени окончания срока действия подписи.
* Расширение для WorkerService -- расширение для модуля _Служба {ws}_, название может отличаться в зависимости от заданного во время xref:GBL-3529@webclient:programmer:other/sample-worker-extension.adoc[разработки расширения]. Представляет собой отдельный конфигурационный файл в формате `.json`, помещаемый в папку расширений Консоли управления `menu:ManagementConsole[SampleExtensions]`.
* После установки _Модуля интеграции с реестром МЧД_ в списке автоматически появляется специальный тип конфигурации _Коннектор к реестру МЧД_.
****
+
. Заполните информацию о подключениях с внешними системами, которые будут использоваться процессом, когда это потребуется для выполнения поставленной задачи.
+
Набор доступных типов соединений зависит от выбранного типа конфигурации и заполняется значением по умолчанию с вкладки _Соединения_. При желании соединения можно изменить. Соответствие типов конфигураций и типов соединений составляется автоматически и не может быть отредактировано из Консоли.
+
****
Соединение {dv}::
Выберите настроенное подключение {dv} из списка. xref:connections-docsvision.adoc[Настроить] подключение можно на вкладке _Соединения_.

WARNING: Если в настройках узла Службы {ws} не указано соединение, при обработке сообщения, требующего соединение данного типа, возникнет ошибка `No connection factory for type.. (please check worker process configuration)`.

Соединение Почтовый сервер::
Выберите из списка настроенное подключение к почтовому серверу. xref:connections-mail-server.adoc[Настроить] подключение можно на вкладке _Соединения_.

Таймаут::
Время ожидания выгрузки рабочего процесса. Если значение не указано (0), используется значение по умолчанию: `60` секунд.

Отключено::
Установите флаг, чтобы отключить обработку заданий данной фоновой операцией. Снимите флаг, чтобы снова включить обработку.
Если такой флаг активен, процесс не запускается.

Использовать x86::
Установите флаг, чтобы переключить обработку заданий на версию {of-ws} с указанной разрядностью. Когда флаг снят, используется разрядность x64.
****
+
. Нажмите *Сохранить*, чтобы добавить созданный процесс на страницу.

NOTE: Каждый процесс можно перезапустить нажатием на кнопку image:buttons/refresh.png[Обновить] рядом с кнопкой удаления.

[#edit]
== Изменить процесс

.Чтобы изменить процесс:
. Наведите курсор на поле, которое хотите изменить, выберите новое значение из списка или установите флаг.
+
Процесс с несохранёнными изменениями будет отмечен красной пунктирной рамкой.
+
.Изменение настроек процесса
image::change-process.png[Изменение настроек процесса]
+
. Нажмите кнопку *Применить*, чтобы сохранить внесённые изменения.

[#delete]
== Удалить процесс

.Чтобы удалить процесс:
. Нажмите на кнопку image:buttons/black-urn.png[Чёрная урна].
. В появившемся диалоге подтвердите удаление.
+
.Подтвердите удаление
image::confirm.png[Подтвердите удаление]
+
. Процесс будет удалён из экземпляра Службы {ws}.
