= Настройка Службы {ws}

Служба {ws} -- дополнительный сервис {dv} для фоновой обработки задач, формируемых компонентами системы {dv}.

Чтобы получить подробную информацию об устройстве Службы {ws}, обратитесь к документации модуля {dv} Служба {ws}, раздел "xref:dev@workerservice::index.adoc[]".

{mc} позволяет управлять фоновыми операциями Службы {ws}: регистрировать новые фоновые операции и выбирать их конфигурацию для обработки задач.

При настройке Службы {ws} следует отличать _узлы_ от _{ws}_. _Узлы_ -- это установленные экземпляры модуля Служба {ws}. Пользователю Модуля не нужно самостоятельно подключать узлы Службы {ws} к {of-mc}. Узлы Службы {ws} автоматически регистрируются в {of-mc}, указанной при их установке.

_Фоновые операции_ -- запущенные на _узле_ экземпляры сервиса, непосредственно обрабатывающего фоновые задачи. Каждый экземпляр _{of-ws}_ ассоциируется с _конфигурацией_, которая определяет перечень обрабатываемых задач и используемых при этом компонентов.

[#tab]
== Вкладка "Служба {ws}"

На вкладке настраивается обработка конкретных экземпляров конфигурации (процессов) на узле {ws}. На данной вкладке администратор решает, будет ли процесс Службы {ws} работать с расширениями модулей или нет.

.Вкладка "Служба {ws}"
image::worker-tab.png[Вкладка "Служба {ws}"]

// В верхней части вкладки указывается адрес подключения к _{to-sett-serv}_.

На вкладке отображаются узлы Службы {ws}.
// На рисунке изображён единственный узел под названием _Administrator Workplace_.
Набор узлов определяется по зарегистрированным узлам в _{sett-serv}_. Узлы добавляются автоматически при установке Службы {ws}.

.Блок настроек узла и процессов
image::node-section.png[Блок настроек узла и процессов]

// .Обновить состояние узла
// image::refresh-node.png[Обновить состояние узла]

После установки модулей {dv} (например, модуля _{bo}_) в _{sett-serv}_ Консоли автоматически появляются процессы Службы {ws}. Каждый узел может обрабатывать процессы с определённым типом конфигурации. Такие процессы отображаются в списке. Тип конфигурации можно выбрать только из тех расширений, с которыми работает данный узел Службы {ws}.

//Под именем узла располагается строка _Файл логов_. В строке указывается имя файла журнала работы _Службы {ws}_. При нажатии на имя файла, будет открыта xref:logs.adoc[страница "Логи"]. Уровень логов настраивается на той же странице.

. Слева располагается кнопка сворачивания и разворачивания настроек узла. При нажатии на кнопку узел будет минимизирован до одной строки.
. Правее кнопки сворачивания/разворачивания располагается название узла и индикатор его текущего состояния. Состояние узла обновляется при обновлении страницы или при нажатии на кнопку обновления в блоке кнопок (5).
+
.Узел может иметь два состояния:
* Доступен -- индикатор зелёный.
* Недоступен -- индикатор красный.
+
. Название процесса. Название задаётся при его создании при помощи кнопки (4).
. [[add]]Кнопка создания нового процесса. При нажатии на кнопку потребуется ввести _Имя процесса_ и выбрать _Тип конфигурации_.
+
.Заполнение данных о процессе
image::add-worker.png[Заполнение данных о процессе]
+
include::partial$excerpts.adoc[tags=name-config]
+
. Блок кнопок справа от заголовка узла.
+
.Кнопки позволяют:
* image:buttons/pencil.png[Переименовать экземпляр службы] -- переименовать экземпляр службы. Имя экземпляра службы формируется в формате `имя-службы : имя-машины`. Уникальное имя службы задаётся во всплывающем меню при нажатии на кнопку карандаша. Имя машины формируется автоматически, исходя из имени машины, на которой установлена Служба {ws}. Если имя узла и имя машины совпадают, отображается только имя машины без двоеточия.
* image:buttons/refresh.png[Перезапустить все процессы] -- нажатие на кнопку перезапускает
все процессы Службы {ws}.
* image:buttons/black-urn.png[Урна] -- кнопка удаляет экземпляр службы. При нажатии возникнет диалог подтверждения удаления с кнопками *Удалить* и *Отмена*.
+
. Блок кнопок напротив заголовка процесса:
+
* image:buttons/black-urn.png[Урна] -- кнопка удаляет экземпляр процесса. При нажатии возникнет диалог подтверждения удаления с кнопками *Удалить* и *Отмена*.
* image:buttons/reload.png[Перезапустить процесс] -- перезапускает выбранный процесс.

[#process]
== Настройки процесса

.Настройки процесса
image::process.png[Настройки процесса]

. Заполните информацию о подключениях с внешними системами, которые будут использоваться процессом, когда это потребуется для выполнения поставленной задачи.
+
****
include::partial$excerpts.adoc[tags=name-config]

Соединение {dv}::
Выберите настроенное подключение {dv} из списка. xref:connections-docsvision.adoc[Настроить] подключение можно на вкладке _Соединения_.
+
Набор доступных типов соединений зависит от выбранного типа конфигурации и заполняется значением по умолчанию с вкладки _Соединения_. При желании соединения можно изменить. Соответствие типов конфигураций и типов соединений составляется автоматически и не может быть отредактировано из Консоли.

WARNING: Если в настройках узла Службы {ws} не указано соединение, при обработке сообщения, требующего соединение данного типа, возникнет ошибка `No connection factory for type.. (please check worker process configuration)`.

Соединение Почтовый сервер::
Выберите из списка настроенное подключение к почтовому серверу. xref:connections-mail-server.adoc[Настроить] подключение можно на вкладке _Соединения_.

Таймаут::
Время ожидания выгрузки рабочего процесса. Если значение не указано (0), используется значение по умолчанию: `60` секунд.

Отключено::
Установите флаг, чтобы отключить обработку заданий данной фоновой операцией. Снимите флаг, чтобы снова включить обработку.
Если такой флаг активен, процесс не запускается.

Использовать x86::
Установите флаг, чтобы переключить обработку заданий на версию {of-ws} с указанной разрядностью. Когда флаг снят, используется разрядность x64.

Дней до окончания действия сертификата::
Только для типа конфигурации *_Обслуживание ЭП_*. Конечный срок даты истечения срока действительности ЭП (по умолчанию 60 дней).

WARNING: Значение поля _Дней до окончания действия сертификата_ не может быть больше срока действия сертификата. В противном случае возможны ошибки `Message: SignaturePeriodicComponent unable verify and enhance signature` в журнале службы {ws}.

// Количество обрабатываемых карточек::
// Только для типа конфигурации *_Обслуживание ЭП_*. Ограничение количества найденных карточек вида "xref:schemas:ROOT:BackOffice.adoc#sign-list[Список подписей]" (по умолчанию 500).

Интервал запросов::
Только для типа конфигурации *_Обслуживание ЭП_*. Периодичность работы компонента по умолчанию 300 сек.
****
+
. Нажмите *Сохранить*, чтобы добавить созданный процесс на страницу.

NOTE: Каждый процесс можно перезапустить нажатием на кнопку image:buttons/refresh.png[Обновить] рядом с кнопкой удаления.

[#edit]
== Изменить процесс

.Чтобы изменить процесс:
. Наведите курсор на поле, которое хотите изменить, выберите новое значение из списка или установите флаг.
+
Процесс с несохранёнными изменениями будет отмечен красной пунктирной рамкой.
+
.Изменение настроек процесса
image::change-process.png[Изменение настроек процесса]
+
. Нажмите кнопку *Применить*, чтобы сохранить внесённые изменения.
+
. В появившемся диалоговом окне подтвердите применение настроек.
. Процесс будет перезапущен, необходимо перезапустить *{wss-new}* вручную.

[#delete]
== Удалить процесс

.Чтобы удалить процесс:
. Нажмите на кнопку image:buttons/black-urn.png[Чёрная урна].
. В появившемся диалоге подтвердите удаление.
+
.Подтвердите удаление
image::confirm.png[Подтвердите удаление]
+
. Процесс будет удалён из экземпляра Службы {ws}.
